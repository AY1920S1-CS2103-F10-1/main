<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 1.5.6.1"><title>Chao Fang How, Gabriel - Project Portfolio</title><link rel="stylesheet" href="../stylesheets/gh-pages.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../stylesheets/coderay-asciidoctor.css"></head><body class="article"><div id="site-header"><nav class="navbar navbar-light bg-light"><div class="container"><a class="navbar-brand" href="../index.html">NurseTraverse</a><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="../UserGuide.html">User Guide</a></li><li class="nav-item"><a class="nav-link" href="../DeveloperGuide.html">Developer Guide</a></li><li class="nav-item"><a class="nav-link active" href="../AboutUs.html">About Us</a></li><li class="nav-item"><a class="nav-link" href="../ContactUs.html">Contact Us</a></li><li class="navitem"><a class="nav-link" href="https://github.com/AY1920S1-CS2103-F10-1/main"><span class="fa fa-github fa-lg" aria-hidden="true"></span>&nbsp;View on GitHub</a></li></ul></div></nav></div><div id="header"><h1>Chao Fang How, Gabriel - Project Portfolio</h1></div><div id="content"><div class="sect1">
<h2 id="project-nursetraverse"><a class="link" href="#project-nursetraverse">PROJECT: NurseTraverse</a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="link" href="#overview">Overview</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>NurseTraverse is a desktop application designed to help community nurses manage all the data they may need, including
visit management, appointment scheduling, and importing and exporting of patient data.
The user interacts with the app using a CLI (Command Line Interface) enhanced with an autocomplete functionality and
ability to undo and redo commands. The app has a GUI created with JavaFX and is written in Java.
NurseTraverse is built by me and 4 other students.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary-of-contributions"><a class="link" href="#summary-of-contributions">Summary of contributions</a></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Major enhancement</strong>: added <strong>the ability to undo/redo previous commands</strong></p>
<div class="ulist">
<ul>
<li>
<p>What it does: allows the user to undo all previous commands one or many at a time. Preceding undo commands can be
reversed by using the redo command.</p>
</li>
<li>
<p>Justification: This feature improves the product significantly because a user can make mistakes in commands and the
app should provide a convenient way to rectify them.</p>
</li>
<li>
<p>Highlights: This enhancement affects existing commands and commands to be added in future. It required an in-depth
analysis of design alternatives. The implementation too was challenging as it required detailed handling of the model
state.</p>
</li>
<li>
<p>Credits: No outside code or ideas were referenced in the development of these features (beyond code that already
exists within <em>Address Book 3</em>).</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Minor enhancement</strong>: added a history GUI panel that displays previous commands, making it much more convenient to
use the multiple undo command.</p>
</li>
<li>
<p><strong>Code contributed</strong>: An overview of contributed code can be found
<a href="https://nus-cs2103-ay1920s1.github.io/tp-dashboard/#=undefined&amp;search=gabrielchao">here</a>. There are filters for
functional and test code. Otherwise, code contributed can be found via references in the following issues:</p>
<div class="ulist">
<ul>
<li>
<p>Main issue: <a href="https://github.com/AY1920S1-CS2103-F10-1/main/issues/59">#59</a></p>
</li>
<li>
<p>Milestone v1.2: <a href="https://github.com/AY1920S1-CS2103-F10-1/main/issues/60">#60</a></p>
</li>
<li>
<p>Milestone v1.3: <a href="https://github.com/AY1920S1-CS2103-F10-1/main/issues/83">#83</a></p>
</li>
<li>
<p>Milestone v1.4: <a href="https://github.com/AY1920S1-CS2103-F10-1/main/issues/203">#203</a></p>
</li>
<li>
<p>Bug hunting: <a href="https://github.com/AY1920S1-CS2103-F10-1/main/pull/197">#197</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Other contributions</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Project management:</p>
<div class="ulist">
<ul>
<li>
<p>Managed release <code>v1.3.1</code> on GitHub</p>
</li>
<li>
<p>Helped pinpoint bugs in other code (Issues <a href="https://github.com/AY1920S1-CS2103-F10-1/main/issues/84">#84</a>,
<a href="https://github.com/AY1920S1-CS2103-F10-1/main/issues/162">#162</a>,
and a severe bug discussed offline and fixed in PR <a href="https://github.com/AY1920S1-CS2103-F10-1/main/pull/120">#120</a>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enhancements to existing features:</p>
<div class="ulist">
<ul>
<li>
<p>Make name comparison case insensitive (Pull request <a href="https://github.com/AY1920S1-CS2103-F10-1/main/pull/197">#197</a>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Community:</p>
<div class="ulist">
<ul>
<li>
<p>PRs reviewed with non-trivial review comments or reviewed to approve:
<a href="https://github.com/AY1920S1-CS2103-F10-1/main/pull/68">#68</a>,
<a href="https://github.com/AY1920S1-CS2103-F10-1/main/pull/69">#69</a>,
<a href="https://github.com/AY1920S1-CS2103-F10-1/main/pull/77">#77</a>,
<a href="https://github.com/AY1920S1-CS2103-F10-1/main/pull/79">#79</a>,
<a href="https://github.com/AY1920S1-CS2103-F10-1/main/pull/85">#85</a>,
<a href="https://github.com/AY1920S1-CS2103-F10-1/main/pull/91">#91</a>,
<a href="https://github.com/AY1920S1-CS2103-F10-1/main/pull/96">#96</a>,
<a href="https://github.com/AY1920S1-CS2103-F10-1/main/pull/105">#105</a>,
<a href="https://github.com/AY1920S1-CS2103-F10-1/main/pull/120">#120</a>,
<a href="https://github.com/AY1920S1-CS2103-F10-1/main/pull/188">#188</a>,
<a href="https://github.com/AY1920S1-CS2103-F10-1/main/pull/195">#195</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="contributions-to-the-user-guide"><a class="link" href="#contributions-to-the-user-guide">Contributions to the User Guide</a></h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Given below are sections I contributed to the User Guide. They showcase my ability to write documentation targeting end-users.</em></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="data-saving-history-undo-redo"><a class="link" href="#data-saving-history-undo-redo">Data Saving, History, Undo, Redo</a></h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>Data Saving, History, Undo, Redo</strong></p>
</div>
<div class="paragraph">
<p>As a community nurse, you will often perform commands that modify information
managed by the application (e.g. patient data). This section describes the
features involving the storage of this data, viewing command history, and
undo-ing / redo-ing commands.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="saving-your-data"><a class="link" href="#saving-your-data">Saving your data</a></h3>
<div class="paragraph">
<p>Your data are saved in the hard disk automatically after any command that changes the data.</p>
</div>
<div class="paragraph">
<p>There is no need to save manually.</p>
</div>
</div>
<div class="sect2">
<h3 id="viewing-the-command-history"><a class="link" href="#viewing-the-command-history">Viewing the command history</a></h3>
<div class="paragraph">
<p>The rightmost panel of the app shows a history of the previous data-modifying commands executed
since the app was started. Examples of data-modifying commands are <code>pat-edit</code> or <code>visit-start</code>.
Commands that do not affect the app data, such as <code>pat-list</code>, are not shown.</p>
</div>
<div class="paragraph">
<p>Each command is displayed with an index number. The most recent command is
shown at the bottom of the history and has the greatest index number. The
earliest command in the history is shown at the top with an index of 1.</p>
</div>
<div class="paragraph">
<p>The app keeps a record of the previous 20 data-modifying commands in the history.</p>
</div>
</div>
<div class="sect2">
<h3 id="undoing-a-command-code-app-undo-code"><a class="link" href="#undoing-a-command-code-app-undo-code">Undoing a command: <code>app-undo</code></a></h3>
<div class="paragraph">
<p>You can undo the changes of the data-modifying commands in the history
with <code>app-undo</code>. All app data will be reverted to how they were before the
undone command was executed.</p>
</div>
<div class="paragraph">
<p><code>app-undo</code> can be used in two ways. The first way is to provide no arguments
to the command. This simply undoes the latest command. The second way is to
specify the index of a command in the history. This would cause all commands
after and including that command to be undone.</p>
</div>
<div class="paragraph">
<p>The command <code>app-undo</code> itself is not affected by <code>app-undo</code> and is not recorded in
the history. To revert an <code>app-undo</code>, use <code>app-redo</code>.</p>
</div>
<div class="paragraph">
<p>Format: <code>app-undo [INDEX]</code></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>If the index is provided, undoes all commands after and including the
indicated command.</p>
</li>
<li>
<p>If the index is <strong>not</strong> provided, undoes the previous data-modifying command.</p>
</li>
<li>
<p>The index, if provided, <strong>must be a positive integer</strong> 1, 2, 3, &#8230;&#8203;</p>
</li>
<li>
<p>Can only undo commands in the history.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pat-clear</code><br>
<code>pat-list</code><br>
<code>app-undo</code> (reverts the <code>pat-clear</code> command)</p>
</li>
<li>
<p>Suppose the history looks like this:</p>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>pat-edit 1 n/Ivan Yeoh</code></p>
</li>
<li>
<p><code>pat-delete 3</code></p>
</li>
<li>
<p><code>pat-clear</code></p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>Now <code>app-undo 2</code> is executed. <code>pat-clear</code> and <code>pat-delete 3</code> are undone in
that order. The app data is now as it was before <code>pat-delete 3</code> was executed.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="redoing-an-undone-command-code-app-redo-code"><a class="link" href="#redoing-an-undone-command-code-app-redo-code">Redoing an undone command: <code>app-redo</code></a></h3>
<div class="paragraph">
<p>You can redo and reapply the changes of the last undone command using <code>app-redo</code>.
This is only possible when the latest data-modifying command (other than
<code>app-redo</code> itself) was an <code>app-undo</code>.</p>
</div>
<div class="paragraph">
<p>Format: <code>app-redo</code></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Redoes the latest undone command.</p>
</li>
<li>
<p>The previous data-modifying command must have been an <code>app-undo</code> (excluding
<code>app-redo</code> itself).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pat-edit 1 n/Ivan Yeoh</code><br>
<code>app-undo</code><br>
<code>app-redo</code> (reverts data to after <code>pat-edit</code> was executed)</p>
</li>
<li>
<p><code>pat-edit 1 n/Ivan Yeoh</code><br>
<code>pat-clear</code><br>
<code>app-undo</code><br>
<code>app-undo</code><br>
<code>app-redo</code> (redoes <code>pat-edit</code>)<br>
<code>app-redo</code> (redoes <code>pat-clear</code>)</p>
</li>
<li>
<p>Suppose the history looks like this:</p>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>pat-edit 1 n/Ivan Yeoh</code></p>
</li>
<li>
<p><code>pat-delete 3</code></p>
</li>
<li>
<p><code>pat-clear</code></p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>Now the following commands are executed:<br>
<code>app-undo 2</code> (reverts <code>pat-clear</code> and <code>pat-delete</code>)<br>
<code>app-redo</code> (redoes <code>pat-delete</code>)<br>
<code>app-redo</code> (redoes <code>pat-clear</code>)</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="contributions-to-the-developer-guide"><a class="link" href="#contributions-to-the-developer-guide">Contributions to the Developer Guide</a></h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Given below are sections I contributed to the Developer Guide. They showcase my ability to write technical documentation and the technical depth of my contributions to the project.</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This set of functionality consists of one GUI component and two commands,
each of which rely on the same core components:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>HistoryPane</code> - GUI component that displays a numbered list of previous
data-modifying commands that can be reverted by <code>app-undo</code>.</p>
</li>
<li>
<p><code>app-undo</code> - Command that reverts until a specified data-modifying command
in the history, or the previous data-modifying command if no argument is specified.</p>
</li>
<li>
<p><code>app-redo</code> - Command that reverts the previous command if and only if it was an <code>app-undo</code>.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="overview-of-changes"><a class="link" href="#overview-of-changes">Overview of Changes</a></h4>
<div class="paragraph">
<p>For undo/redo/history to function, there must be the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A way to mark which <code>Command</code> s are data-modifying commands so that
non-data-modifying commands can be ignored.</p>
</li>
<li>
<p>A mechanism to clearly demarcate the model state before and after the execution
of each data-modifying command.</p>
</li>
<li>
<p>A way to record the state of the model before (or after) each command, together
with the <code>Command</code> object responsible.</p>
</li>
<li>
<p>Methods to switch the state of the model back and forth from the states stored
in the history.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To achieve this, the following classes are introduced:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MutatorCommand</code> - An empty subclass of <code>Command</code> to indicate that a <code>Command</code> is a
data-modifying command and should be considered for undo/redo/history.</p>
</li>
<li>
<p><code>HistoryRecord</code> - Record of the command and data of one atomic commit in the command history. It consists of the
<code>MutatorCommand</code> responsible for the commit and the state of the model either before or after the commit. All recorded
states are deep copies decoupled from their original references.</p>
</li>
<li>
<p><code>HistoryManager</code> - Represents the history of the application. Maintains data structures containing <code>HistoryRecord</code> s
of each data state change.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, <code>LogicManager</code> and <code>Model</code> are modified to accommodate this functionality.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Shallow Copy vs Deep copy</div>
<div class="ulist">
<ul>
<li>
<p>Performing a <em>shallow copy</em> of an object simply copies the values of the
references of each object the original object is pointing to. This results in the
copied object pointing to the same objects as the original. In the figure below,
<code>patientBook</code> and <code>copiedPatientBook</code> are separate <code>PatientBook</code> objects but actually
share the same <code>patient</code> object. Changes to <code>patient</code> through <code>PatientBook</code> would thus
affect <code>copiedPatientBook</code> as well.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/shallow_copy.png" alt="shallow copy">
</div>
<div class="title">Figure 1. Shallow copy</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Performing a <em>deep copy</em> creates duplicates of each object referenced by the original,
the objects referenced by those duplicates, and so on. These duplicates are completely
decoupled from their originals. In the figure below, <code>patient</code> is a different
object from <code>copiedPatient</code>, thus changes to <code>patient</code> would not affect <code>copiedPatient</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/deep_copy.png" alt="deep copy">
</div>
<div class="title">Figure 2. Deep copy</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following methods are added to the <code>ModelManager</code> class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Model#commit(MutatorCommand)</code> - Commits the changes made to the address book since the last call to this method,
making them permanent and updating the UI data. Creates a new <code>HistoryRecord</code> containing the committing
<code>MutatorCommand</code> and the <code>PatientBook</code> and <code>AppointmentBook</code> states before the execution of the command and pushes it
to the <code>HistoryManager</code> for storage.</p>
</li>
<li>
<p><code>Model#getHistory()</code> - Returns an unmodifiable view of the history.</p>
</li>
<li>
<p><code>Model#undoTo(HistoryRecord)</code> - Reverts current model state to the that contained in the specified <code>HistoryRecord</code>
(i.e. the state before the command was executed).</p>
</li>
<li>
<p><code>Model#redo()</code> - Redoes the previous <code>MutatorCommand</code> if it was an undo by popping the latest <code>HistoryRecord</code> from the
<code>HistoryManager</code> 's redo stack.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Furthermore, in addition to <code>MutatorCommand</code> which was described earlier, the following logical classes are added:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>UndoCommand</code> - Undoes a designated command in the history, or the previous one if no argument is specified. The
<code>COMMAND_WORD</code> for this command is <code>app-undo</code>.</p>
</li>
<li>
<p><code>UndoCommandParser</code> - Parses input arguments and creates a new UndoCommand object.</p>
</li>
<li>
<p><code>RedoCommand</code> - Redoes the previous command if it was an undo. The <code>COMMAND_WORD</code> for this command is <code>app-redo</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>HistoryManager</code> checks the classes of commands pushed to the history and does not record
them if they are instances of <code>UndoCommand</code> or <code>RedoCommand</code>. This ensures that successive <code>UndoCommand</code> s do
not undo themselves instead of the desired data-modifying commands, requiring <code>RedoCommand</code> for
the special case of undo reversion.</p>
</div>
</div>
<div class="sect3">
<h4 id="example-usage-scenario"><a class="link" href="#example-usage-scenario">Example Usage Scenario</a></h4>
<div class="paragraph">
<p>The following example usage scenario and the state of <code>historyManager</code> at each step.</p>
</div>
<div class="paragraph">
<p><strong>Step 1</strong>: The user launches the application.<br></p>
</div>
<div class="paragraph">
<p><code>HistoryManager</code> is initialized with empty <code>history</code> and <code>redoStack</code> objects.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/UndoRedoState0.png" alt="UndoRedoState0" width="200">
</div>
<div class="title">Figure 3. Initial state of <code>historyManager</code></div>
</div>
<div class="paragraph">
<p><strong>Step 2</strong>: The user executes the command <code>pat-delete 3</code>.<br></p>
</div>
<div class="paragraph">
<p>After the <code>DeleteCommand</code> makes its changes on the model, <code>logicManager</code> calls <code>Model#commit(MutatorCommand)</code>,
passing the command object into <code>modelManager</code>. In turn, <code>modelManager</code> passes the command object, <code>stagedPatientBook</code>,
and <code>stagedAppointmentBook</code> into <code>historyManager</code> through
<code>HistoryManager#pushRecord(MutatorCommand, PatientBook, AppointmentBook)</code>.<br></p>
</div>
<div class="paragraph">
<p><code>historyManager</code> uses those objects to create a new <code>HistoryRecord</code> object which contains the model state <strong>before</strong> the
command was executed (here labelled <code>hr0</code>) and pushes it into the <code>history</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/UndoRedoState1.png" alt="UndoRedoState1" width="300">
</div>
<div class="title">Figure 4. <code>historyManager</code> after <code>pat-delete 3</code> is executed</div>
</div>
<div class="paragraph">
<p><strong>Step 3</strong>: The user executes the command <code>visit-start</code>.<br></p>
</div>
<div class="paragraph">
<p>The interaction between <code>logicManager</code>, <code>modelManager</code> and <code>historyManager</code> is the same as before.</p>
</div>
<div class="paragraph">
<p><code>historyManager</code> creates a new <code>HistoryRecord</code> object (here labelled <code>hr1</code>) and pushes it into the <code>history</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/UndoRedoState2.png" alt="UndoRedoState2" width="300">
</div>
<div class="title">Figure 5. <code>historyManager</code> after <code>visit-start</code> is executed</div>
</div>
<div class="paragraph">
<p><strong>Step 4</strong>: The user wants to revert to the first item in the history, so he executes the command <code>app-undo 1</code>.<br></p>
</div>
<div class="paragraph">
<p>First, the <code>UndoCommand</code> retrieves the <code>HistoryRecord</code> corresponding to the first item in the history by searching the
list returned by <code>Model#getHistory()</code>. Then, <code>UndoCommand</code> calls <code>Model#undoTo(HistoryRecord)</code> passing in the target
record. When this happens, <code>modelManager</code> calls <code>historyManager#popRecordsTo(HistoryRecord)</code> to pop all records after
and including the target record from the history (<code>hr1</code> and <code>hr0</code> in the previous step). The <code>historyManager</code> uses
these popped records to create new records of the model state <strong>after</strong> the commands were executed, and places these
new records (<code>hr2</code> and <code>hr3</code>) into the <code>redoStack</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/UndoRedoState3.png" alt="UndoRedoState3" width="300">
</div>
<div class="title">Figure 6. <code>historyManager</code> after <code>app-undo 1</code> is executed</div>
</div>
<div class="paragraph">
<p>Finally, <code>modelManager</code> calls <code>ModelManager#changeBaseTo(PatientBook, AppointmentBook)</code> using the state objects in the
target record. This performs the actual reversion of the state.<br></p>
</div>
<div class="paragraph">
<p>The action of the <code>UndoCommand</code> is summarised in the sequence diagram below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/UndoSequenceDiagram.png" alt="UndoSequenceDiagram" width="630">
</div>
<div class="title">Figure 7. Sequence diagram for <code>app-undo</code></div>
</div>
<div class="paragraph">
<p><strong>Step 5</strong>: The user wants to redo <code>pat-delete 3</code>, so he executes the command <code>app-redo</code>.<br></p>
</div>
<div class="paragraph">
<p>The <code>RedoCommand</code> calls <code>Model#redo()</code>. The <code>modelManager</code> calls <code>HistoryManager#popRedo(PatientBook, AppointmentBook)</code>
passing it the current <code>stagedPatientBook</code> and <code>stagedAppointmentBook</code>.<br></p>
</div>
<div class="paragraph">
<p><code>historyManager</code> pops the record at the top of the <code>redoStack</code> (<code>hr3</code>) and uses its <code>command</code>, together with the
<code>PatientBook</code> and <code>AppointmentBook</code> just passed in by the <code>modelManager</code>, to create a new <code>HistoryRecord</code> (<code>hr4</code>)
describing the model state <strong>before</strong> that command was executed. It then pushes <code>hr4</code> into the history.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/UndoRedoState4.png" alt="UndoRedoState4" width="400">
</div>
<div class="title">Figure 8. <code>historyManager</code> after <code>app-redo</code> is executed</div>
</div>
<div class="paragraph">
<p><code>historyManager#popRedo()</code> returns the <code>HistoryRecord</code> (<code>hr3</code>) containing the state after the redo. <code>modelManager</code>
can now call <code>ModelManager#changeBaseTo()</code> to change the state to it.</p>
</div>
<div class="paragraph">
<p><strong>Step 6</strong>: The user executes the command <code>pat-clear</code>.</p>
</div>
<div class="paragraph">
<p>The action of the <code>logicManager</code> and <code>modelManager</code> is similar what is described in <strong>Step 2</strong>; only this time, when
<code>modelManager</code> calls <code>HistoryManager#pushRecord(MutatorCommand, PatientBook, AppointmentBook)</code>, the
<code>historyManager</code> sees that the committing command is not an <code>UndoCommand</code> or a <code>RedoCommand</code> and clears the
<code>redoStack</code> to avoid branching.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/UndoRedoState5.png" alt="UndoRedoState5" width="300">
</div>
<div class="title">Figure 9. <code>historyManager</code> after <code>pat-clear</code> is executed</div>
</div>
</div>
<div class="sect3">
<h4 id="model-and-logic-design-considerations"><a class="link" href="#model-and-logic-design-considerations">Model and Logic Design Considerations</a></h4>
<div class="sect4">
<h5 id="aspect-how-to-undo-and-redo-between-states"><a class="link" href="#aspect-how-to-undo-and-redo-between-states">Aspect: How to undo and redo between states</a></h5>
<div class="ulist">
<ul>
<li>
<p><strong>Alternative 1 (current choice)</strong>: Save the entire <code>PatientBook</code> and <code>AppointmentBook</code> objects to
record each model state.</p>
<div class="ulist">
<ul>
<li>
<p>Pros: Easier to implement.</p>
</li>
<li>
<p>Cons: Consumes more memory.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Alternative 2: Only save the <code>MutatorCommand</code> objects but implement an <code>undo()</code>
method for each <code>MutatorCommand</code> which does exactly the reverse of its <code>execute()</code> method.</p>
<div class="ulist">
<ul>
<li>
<p>Pros: Consumes much less memory.</p>
</li>
<li>
<p>Cons: Difficult to implement - doubles the amount of work needed for each command.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="aspect-how-to-record-the-patientbook-and-appointmentbook-states-in-the-history"><a class="link" href="#aspect-how-to-record-the-patientbook-and-appointmentbook-states-in-the-history">Aspect: How to record the PatientBook and AppointmentBook states in the history</a></h5>
<div class="ulist">
<ul>
<li>
<p>Alternative 1: Simply store references to <code>PatientBook</code> and <code>AppointmentBook</code>.</p>
<div class="ulist">
<ul>
<li>
<p>Pros: Easier to implement.</p>
</li>
<li>
<p>Cons: Relies on the assumption that the objects in <code>PatientBook</code> and <code>AppointmentBook</code>
are immutable; if they are not truly immutable, changes to the current model&#8217;s
<code>PatientBook</code> and <code>AppointmentBook</code> state may leak and affect the states stored in
the history.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Alternative 2 (current choice):</strong> Defensively store deep copies of the <code>PatientBook</code> and <code>AppointmentBook</code>.</p>
<div class="ulist">
<ul>
<li>
<p>Pros: Prevents improperly coded <code>Patient</code> or <code>Appointment</code> (or their
associated classes) from breaking undo/redo/history functionality. Can reuse JSON serialization code for persistent
storage of <code>PatientBook</code> and <code>AppointmentBook</code> to create deep copies by serializing then immediately deserializing them.</p>
</li>
<li>
<p>Cons: Consumes more memory and CPU time. More difficult to implement - MVC pattern between UI view and models is
broken in two. This is because each time the current state is swapped with a state in the  history by <code>ModelManager</code>,
the <code>ObservableList</code> viewed by the UI must also be  updated by the <code>ModelManager</code> instead of the <code>PatientBook</code> as the
current <code>PatientBook</code> is completely decoupled and placed into the history.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="aspect-which-class-to-place-the-historymanager-in"><a class="link" href="#aspect-which-class-to-place-the-historymanager-in">Aspect: Which class to place the HistoryManager in</a></h5>
<div class="ulist">
<ul>
<li>
<p><strong>Alternative 1 (current choice):</strong> Make <code>HistoryManager</code> a field of <code>ModelManager</code>.</p>
<div class="ulist">
<ul>
<li>
<p>Pros: Ensures atomicity of the records in the history as pushing a transaction
to the <code>HistoryManager</code> can only be (and is always) done by <code>Model#commit()</code>
itself - records in the history are guaranteed to be products of complete command
execution rather than intermediate states.</p>
</li>
<li>
<p>Cons: More difficult to test <code>ModelManager</code> as two <code>ModelManager</code> objects may have
the same current state but differing <code>HistoryManager</code> objects. May violate Single Responsibility Principle as
<code>ModelManager</code> now has to manage both its current state and its previous states.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Alternative 2: Make <code>HistoryManager</code> a field of <code>LogicManager</code>.</p>
<div class="ulist">
<ul>
<li>
<p>Pros: Higher cohesion as <code>ModelManager</code> only represents the model&#8217;s current state. Easier to test <code>ModelManager</code>
as only its current state matters.</p>
</li>
<li>
<p>Cons: It is possible for intermediate model states to be pushed to the <code>HistoryManager</code> - trusts <code>LogicManager</code> to
push the transaction to history after (and only after) calling <code>Model#commit()</code>. Requires <code>Command#execute()</code> to
accept <code>HistoryManager</code> as a parameter just so <code>UndoCommand</code> and <code>RedoCommand</code> can work even though the vast majority
of commands do not require it.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ui"><a class="link" href="#ui">UI</a></h4>
<div class="paragraph">
<p>The command history is constantly displayed in a panel on the right side of
the app. This <code>HistoryPanel</code> uses <code>HistoryRecordCard</code> s to display the
user-input text that invoked each command. It is a view of the <code>ObservableList&lt;HistoryRecord&gt;</code>
returned by <code>HistoryManager#asUnmodifiableObservableList()</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ui-design-considerations"><a class="link" href="#ui-design-considerations">UI Design Considerations</a></h4>
<div class="sect4">
<h5 id="aspect-where-to-display-the-history"><a class="link" href="#aspect-where-to-display-the-history">Aspect: Where to display the history</a></h5>
<div class="ulist">
<ul>
<li>
<p><strong>Alternative 1 (current choice):</strong> Permanently display it in a dedicated panel.</p>
<div class="ulist">
<ul>
<li>
<p>Pros: User does not have to execute a 'history' command to view the history,
making it much easier to use the multiple undo function.</p>
</li>
<li>
<p>Cons: Takes up more space in the UI.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Alternative 2: Display it as a tab in the <code>TabPane</code>.</p>
<div class="ulist">
<ul>
<li>
<p>Pros: Saves space in the UI.</p>
</li>
<li>
<p>Cons: User has to switch to the history tab to view it. Less intuitive UX as the other tabs in the <code>TabPane</code> all
display actual data such as <code>Patient</code>, <code>Visit</code>, and <code>Appointment</code> info, whereas history is app metadata.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div></div><div id="footer"><div class="container"><div id="footer-text">Last updated 2019-11-13 05:13:32 UTC</div></div></div></body></html>